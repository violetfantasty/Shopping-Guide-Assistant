# 🎁 雅戈尔智能导购助手（基于 FastAPI + Gradio + LLM）

## 📘 项目概述

本项目搭建了一套面向零售场景的轻量级**智能导购助手**，结合 **NIM** 调用大模型，使用 **FAISS** 进行向量检索，前端采用 **Gradio**，后端基于 **FastAPI** 异步框架。通过端到端的异步流式交互体验，实现四类业务场景的智能辅助功能：

- 🎂 **会员生日祝福**  
- 🌦️ **门店天气提醒**  
- 🎉 **节日祝福生成**  
- 🛍️ **商品匹配推荐**  

此外，该项目还与 MySQL 数据库对接和调用外部天气接口，给大模型的智能生成提供外部信息。

---

## 📂 项目结构与脚本功能

- **`page.py`（前端交互脚本）**  
  使用 Gradio 快速搭建用户界面，包含功能模式下拉、编码与附加信息输入、生成结果输出。前端负责捕获用户输入、调用后端接口，并以流式方式实时显示文本增量。

- **`script.py`（后端业务逻辑）**  
  基于 FastAPI 异步框架，加载预构建的 FAISS 索引与 ID 映射，并通过 aiomysql 建立数据库连接池。服务暴露 `/script` POST 接口，根据不同 `mode` 调度相应业务流程，调用 AsyncOpenAI 接口执行大模型生成或推理，最终以 StreamingResponse 返回流式结果。

- **`data.py`（向量嵌入构建脚本）**  
  对业务文本数据进行清洗与抽样，通过 NIM 嵌入模型生成向量，并使用 FAISS FlatL2 索引构建离线检索库，保存索引文件与文本 ID 映射，为商品匹配提供底层检索能力。

---

## 🔧 技术架构

- **后端框架**：FastAPI（异步路由与流式输出）  
- **前端界面**：Gradio（快速搭建）  
- **大模型服务**：NVIDIA OpenAI API（流式生成）  
- **数据库支持**：aiomysql（异步 MySQL 连接池）  
- **天气接口**：httpx（异步请求天气数据）  
- **向量检索**：FAISS（用于商品匹配与相似度检索）

---

## 📦 功能模块说明

### 🎂 模式 0：生日祝福生成
- 从数据库查询会员 `姓名`、`性别`、`生日`  
- 结合会员信息、当前日期和可选补充描述，拼装多步 Prompt  
- 调用 LLaMA-3.1 Ultra 模型生成个性化中文祝福，并自动插入 emoji

### 🌦️ 模式 1：天气提醒生成
- 根据门店编码获取 `城市行政编码`  
- 调用彩云天气 API 获取实时天气预报与预警  
- 构建说明性提示，调用 NIM 接口输出安全出行、穿衣建议等提醒话术

### 🎉 模式 2：节日祝福推送
- 查询会员信息并计算年龄  
- 识别用户输入的节日名称或默认最近节日  
- 结合节日风俗与用户画像，调用 LLaMA-3.1 Ultra 生成富有节日氛围的祝福

### 🛍️ 模式 3：商品匹配推荐
- 查询会员 `性别`、`年龄` 与附加信息组成特征字符串  
- 调用 NIM 嵌入接口生成 query embedding  
- 在 FAISS 索引中检索 Top-K 相似记录  
- 构建导购推荐 prompt，调用 DeepSeek-R1 模型输出商品类别、风格、颜色等推荐要点

---

## 💡 系统流程图（简化）

```text
Gradio 界面输入
    │
    ▼
FastAPI 接口（/script）
    │
    ├─ 异步查询 MySQL 数据库
    ├─ 请求天气 API（如模式 1）
    └─ 多步 Prompt 拼装 → NIM 流式调用
        │
        ▼
    大语言模型服务
        │
        ▼
   StreamingResponse 流式返回
        │
        ▼
Gradio 实时渲染增量文本
```

---

## 🧠 技术亮点

1. **异步全链路**：FastAPI + asyncio + HTTPX + aiomysql + StreamingResponse，实现非阻塞数据库与模型调用，保证高并发和实时交互。  
2. **向量检索与生成融合**：在商品匹配中先检索再生成，大幅提升推荐相关性与个性化程度。  
3. **流式输出体验**：客户端可实时接收增量文本，提升用户交互流畅度，模拟真实聊天体验。  
4. **模块化可扩展**：预留向量检索与图像生成接口，可快速拓展更多业务场景。

---

## 🎯 项目成果与收获

- **演示成功**：顺利在赛场环境展示四大功能模块，业务逻辑清晰，交互体验友好。  
- **技术掌握**：熟悉 NVIDIA 集成 OpenAI 接口使用、FAISS 索引构建与检索流程、异步 Python 编程模式。  
- **性能表现**：向量检索耗时 <10ms，大模型流式输出延迟可控，满足演示需求。

---

## ⚙️ 挑战与优化空间

- **大模型调优**：优化 prompt 结构或引入知识增强，提升生成准确度；模型量化或蒸馏降低调用成本与延迟。  
- **检索规模扩展**：对接 HNSW/IVF 或专业向量数据库，支持百万级样本检索，保证性能与稳定性。  
- **业务闭环**：接入日志与用户反馈系统，构建自动化调参与增量学习管道，提升系统智能度。

---

## 🚀 未来展望

- 多模态融合：结合商品图像与文本描述，实现更丰富的推荐维度。  
- 增量索引更新：实时插入新样本，无需重建全量索引。  
- 跨平台接入：支持移动端、微信小程序及企业内部系统对接。  
- 智能运营：结合用户行为与反馈，自动化调整营销策略与推荐逻辑。

